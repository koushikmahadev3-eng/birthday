<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy birthday</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'serif'; }
        #ui {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
            text-align: center;
            pointer-events: none;
            transition: opacity 2s;
        }
        h1 {
            color: white;
            font-size: 4rem;
            text-shadow: 0 0 20px #ff3366;
            margin: 0;
            opacity: 0;
        }
        #gate {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        .heart-loader {
            width: 50px;
            height: 50px;
            background: #ff3366;
            transform: rotate(-45deg);
            box-shadow: 0 0 50px #ff3366;
            animation: beat 1s infinite;
        }
        .heart-loader::before, .heart-loader::after {
            content: '';
            width: 50px;
            height: 50px;
            background: #ff3366;
            border-radius: 50%;
            position: absolute;
        }
        .heart-loader::before { top: -25px; left: 0; }
        .heart-loader::after { top: 0; left: 25px; }
        @keyframes beat {
            0%, 100% { transform: rotate(-45deg) scale(1); }
            50% { transform: rotate(-45deg) scale(1.2); }
        }
        .tap-text { color: white; margin-top: 60px; letter-spacing: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="gate">
        <div class="heart-loader"></div>
        <div class="tap-text">CLICK TO AWAKEN</div>
    </div>

    <div id="ui">
        <h1 id="title">HAPPY BIRTHDAY</h1>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        let scene, camera, renderer, composer, clock;
        let branches = [];
        
        const gate = document.getElementById('gate');
        const title = document.getElementById('title');

        function init() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.02);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // Post Processing for that "God Level" Glow
            const renderScene = new RenderPass(scene, camera);
            const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
            bloomPass.threshold = 0;
            bloomPass.strength = 1.2;
            bloomPass.radius = 1;

            composer = new EffectComposer(renderer);
            composer.addPass(renderScene);
            composer.addPass(bloomPass);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
            scene.add(ambientLight);

            // Stars Background
            const starGeometry = new THREE.BufferGeometry();
            const starMaterial = new THREE.PointsMaterial({ color: 0xffffff });
            const starVertices = [];
            for (let i = 0; i < 5000; i++) {
                starVertices.push(THREE.MathUtils.randFloatSpread(200), THREE.MathUtils.randFloatSpread(200), THREE.MathUtils.randFloatSpread(200));
            }
            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);

            clock = new THREE.Clock();
            animate();
        }

        function createHeartMesh() {
            const shape = new THREE.Shape();
            const x = 0, y = 0;
            shape.moveTo(x + 0.25, y + 0.25);
            shape.bezierCurveTo(x + 0.25, y + 0.25, x + 0.2, y, x, y);
            shape.bezierCurveTo(x - 0.3, y, x - 0.3, y + 0.35, x - 0.3, y + 0.35);
            shape.bezierCurveTo(x - 0.3, y + 0.55, x - 0.1, y + 0.77, x + 0.25, y + 0.95);
            shape.bezierCurveTo(x + 0.6, y + 0.77, x + 0.8, y + 0.55, x + 0.8, y + 0.35);
            shape.bezierCurveTo(x + 0.8, y + 0.35, x + 0.8, y, x + 0.5, y);
            shape.bezierCurveTo(x + 0.35, y, x + 0.25, y + 0.25, x + 0.25, y + 0.25);

            const extrudeSettings = { depth: 0.1, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 0.1, bevelThickness: 0.1 };
            const geometry = new THREE.ExtrudeGeometry(shape, extrudeSettings);
            const material = new THREE.MeshPhongMaterial({ color: 0xff3366, emissive: 0xff0033 });
            const mesh = new THREE.Mesh(geometry, material);
            mesh.scale.set(0.2, 0.2, 0.2);
            mesh.rotation.z = Math.PI;
            return mesh;
        }

        function growTree(start, direction, length, thickness, depth) {
            if (depth > 8) return;

            const end = new THREE.Vector3().addVectors(start, direction.clone().multiplyScalar(length));
            
            // Draw branch using a cylinder
            const curve = new THREE.LineCurve3(start, end);
            const tubeGeo = new THREE.TubeGeometry(curve, 1, thickness, 8, false);
            const tubeMat = new THREE.MeshPhongMaterial({ color: 0x221111 });
            const branch = new THREE.Mesh(tubeGeo, tubeMat);
            scene.add(branch);

            if (depth > 4) {
                const leaf = createHeartMesh();
                leaf.position.copy(end);
                leaf.rotation.y = Math.random() * Math.PI;
                scene.add(leaf);
            }

            const numChildren = 2;
            for (let i = 0; i < numChildren; i++) {
                const newDir = direction.clone()
                    .applyAxisAngle(new THREE.Vector3(1, 0, 0), (Math.random() - 0.5) * 1.5)
                    .applyAxisAngle(new THREE.Vector3(0, 1, 0), (Math.random() - 0.5) * 1.5)
                    .normalize();
                
                setTimeout(() => {
                    growTree(end, newDir, length * 0.75, thickness * 0.7, depth + 1);
                }, depth * 150);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getElapsedTime();
            
            // Gentle camera motion
            camera.position.x = Math.sin(delta * 0.3) * 10;
            camera.position.z = Math.cos(delta * 0.3) * 15;
            camera.lookAt(0, 5, 0);

            composer.render();
        }

        gate.addEventListener('click', () => {
            gate.style.opacity = '0';
            setTimeout(() => {
                gate.style.display = 'none';
                title.style.opacity = '1';
                // Audio - Using a generic cinematic swell source
                const audio = new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/descent/background%20music.mp3');
                audio.volume = 0.5;
                audio.play();
                
                growTree(new THREE.Vector3(0, -5, 0), new THREE.Vector3(0, 1, 0), 4, 0.3, 0);
            }, 1000);
        });

        init();
    </script>
</body>
</html>
